extends ../templates/layout.jade
block head
  script(type="text/javascript").
    var idx = window.location.toString().indexOf("#_=_");
    if (idx > 0) {
      window.location = window.location.toString().substring(0, idx);
      history.pushState('', document.title, window.location.pathname);
    }
    
  script(src='/js/build/moment.js')

block body
  div#posts
    include ../templates/_header
    main.main
      .post-featured
        .post-featured-inner.cf
          p.post-featured-label Daily Infographic
          .post-featured-image-wrap
            img(src=featured.image_url)
          .post-featured-details
            h4.details-title=featured.title
            p.details-category=featured.category
            p.details-content=featured.content
            a.details-link(href=featured.url) View Graphic
            a.details-save(href=featured.url) Save
      .main-content
        .posts
          h4.posts-title Recent graphics
          .posts-recent
            for post in posts
              +postBlock(post)
          .posts-catories
            each category, key in categories
              if category.length
                h4.posts-title=key
                for post in category
                  +postBlock(post)
mixin postBlock(post)
  .post
    .post-image-wrap
      img.post-image(src='#{post.image_url}' width='300')
    a(href='#{post.url}' title='#{post.title}')
      .post-info
        h4.post-title #{post.title}
        .post-tags
          span.post-day #{post.category}
          span &nbsp;|&nbsp;
          span.post-date #{fromDate(post.date_created)}
        .post-actions
          a.post-link(href=post.url title=post.title) View graphic 
